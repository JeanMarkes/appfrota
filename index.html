<!DOCTYPE html>
<html>
<head>
    <title>Pesquisa de Placa ou Número de Ordem</title>
</head>
<body>
    <h1>Pesquisa de Placa ou Número de Ordem</h1>

    <form id="search-form">
        <input type="radio" id="search-type-placa" name="search-type" value="placa" checked>
        <label for="search-type-placa">Pesquisar por Placa</label>
        <input type="radio" id="search-type-numero-ordem" name="search-type" value="numero_ordem">
        <label for="search-type-numero-ordem">Pesquisar por Número de Ordem</label>
        
        <label for="term">Digite a placa ou número de ordem:</label>
        <input type="text" id="term" name="term" required>
        <button type="submit">Pesquisar</button>
    </form>

    <div id="result"></div>

    <script>
        // Função para buscar as informações por placa ou número de ordem
        function searchInfo() {
            var searchType = document.querySelector('input[name="search-type"]:checked').value;
            var term = document.getElementById("term").value;
            var resultDiv = document.getElementById("result");

            // URL pública da planilha no formato CSV
            var url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRul4T7a8YGSZ5OONIujRqCV-ro-pZtGpLd-dEmmnxBQ7YMEfBV8I2Xssawiv4fLHKkilZd2YEBHx5R/pub?output=csv";

            fetch(url)
                .then(response => response.text())
                .then(csvData => {
                    // Parse CSV data into an array of objects
                    var lines = csvData.split("\n");
                    var headers = lines[0].split(",");
                    var data = [];

                    for (var i = 1; i < lines.length; i++) {
                        var currentLine = lines[i].split(",");
                        var obj = {};

                        for (var j = 0; j < headers.length; j++) {
                            obj[headers[j]] = currentLine[j];
                        }

                        data.push(obj);
                    }

                    // Find the vehicle information by placa or numero_ordem
                    var foundVehicle = data.find(item => {
                        if (searchType === "placa") {
                            return item.placa === term || item.placa_anterior === term;
                        } else if (searchType === "numero_ordem") {
                            return item.n_ordem === term;
                        }
                    });

                    if (foundVehicle) {
                        resultDiv.innerHTML = "Informações do veículo com " + (searchType === "placa" ? "placa" : "número de ordem") + " " + term + ":<br>";
                        resultDiv.innerHTML += "Unidade: " + foundVehicle.unidade + "<br>";
                        resultDiv.innerHTML += "Chassi: " + foundVehicle.chassi + "<br>";
                        resultDiv.innerHTML += "Renavam: " + foundVehicle.renavam + "<br>";
                    } else {
                        resultDiv.innerHTML = "Nenhum veículo com " + (searchType === "placa" ? "placa" : "número de ordem") + " " + term + " foi encontrado na planilha.";
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = "Erro na pesquisa: " + error;
                });
        }

        // Adicione um manipulador de eventos para o formulário
        document.getElementById("search-form").addEventListener("submit", function (e) {
            e.preventDefault();
            searchInfo();
        });
    </script>
</body>
</html>
